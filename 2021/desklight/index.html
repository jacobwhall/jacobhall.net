<!DOCTYPE html>
<html lang="en">
<head>
		<title>üí° Control my Desk Light</title>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="theme-color" content="#FFFFFF"/>
		<!-- <link rel="stylesheet" type="text/css" href="/articlestyle.css"> -->
		<style>
		/* sitewide stuff like fonts and title sizes */
		body {
			text-align: center;
			font-family: 'Work Sans', sans-serif;
			font-size: 100%;
			font-size: max(100%, .4cm);
		}

		@media (max-aspect-ratio: 1/1) {
			body {
				font-size: 4vw;
				font-size: min(4vw, .4cm);
			}
		}
		body, h1, h2, h3, h4, h5, h6 {
			font-size-adjust: 0.5;
		}

		ul {
			list-style-position: inside;
			padding-left: 0.5em;
		}
		/* h-entry rules */
		.p-note {
			display: none;
		}
		
		/* code highlighting rules */
		.code {
			overflow-x:auto;
			/* white-space: pre-wrap; */
			font-family: monospace;
		}
		pre.code {
			border: 1em solid #2c2e34;
			border-radius: 1em;	
			color: #c5cdd9;
			background-color: #2c2e34;
		}
		.code a {
			color: inherit;
		}
		.code .Comment {
			color: #828a98;
			font-style: italic;
		}
		.code .Constant {
			color: #a0c980;
		}
		/* not used? might remove. i don't make errors ;) */
		.code .Error {
			color: #ffffff;
			background-color: #ff6060;
			padding-bottom: 1px;
		}
		.code .Identifier {
			color: #6cb6eb;
		}
		.code .PreProc {
			color: #ec7279;
		}
		.code .Special {
			color: #c5cdd9;
		}
		.code .Statement {
			color: #d38aea;
		}	
		.code .vimCommand {
			color: #d38aea;
		}	
		.code .texStatement {
			color: #6cb6eb;
		}
		.code .texSpecial {
			color: #deb974;
		}
		#license #indiewebring {
			display: inline-block;
			width: 50em;
			min-width: 50%;
			max-width: 100%;
		}
u:-webkit-scrollbar {
    display: none;
}

.warning {
  color:red;
}
#backprofilepic {
	border-radius: 50%;
	height: 4em;
}
/*
#backarrow {
  width: 6em;
  height: 6em;
  padding-top: 1.25em;
  padding-left: 1.25em;
  border-radius: 50%;
}
*/
#sidebar {
	padding: 1em;
	text-align: left;
	line-height: 2em;
}
.date {
	color: gray;
	font-style: italic;
}
.nostyle {
	color: black;
	text-decoration: none;
}

		table {
			margin: 0 auto;
			border-collapse: collapse;
			margin-bottom: 1em;
		}
		table, th, td {
			border: 1px solid black;
		}
		th, td {
			padding: .5em;
		}
		#scifairimg {
			object-fit: scale-down;
			width: 100%;
			max-width: 40em;
		}
		.graph {
			object-fit: contain;
			width: 100%;
			max-width: 30em;
		}
		.graphboxwrapper {
			text-align: center;
		}
		.graphbox {
			display:inline-block;
			padding: .75em;
			border: 1px solid lightgrey;
		}
		.slider {
			object-fit: contain;
			width: 100%;
			max-width: 34.5em;
		}
		#backprofilepic {
			border-radius: 50%;
			height: 4em;
		}
		#sidebar {
			padding: 1em;
			text-align: left;
			line-height: 2em;
		}
		.nostyle {
			color: black;
			text-decoration: none;
		}

		/* entire container, keeps perspective */
		.flip-container {
			float: left;
			padding-right: 1em;
			padding-bottom: 1em;
			display: inline-block;	
			perspective: 1000px;
		}
		.flip-container, .front, .back {
			border-radius: 50%;
			width: 4em;
			height: 4em;
		}
		/* flip speed goes here */
		.flipper {
			transition: 0.4s;
			transform-style: preserve-3d;
			position: relative;
		}
		/* hide back of pane during swap */
		.front, .back {
			text-align: center;
			backface-visibility: hidden;
			position: absolute;
			top: 0;
			left: 0;	
		}
		/* front pane, placed above back */
		.front {
			z-index: 2;
			/* for firefox 31 */
			transform: rotateY(0deg);
		}
		/* back, initially hidden pane */
		.back {
			line-height:4em;
			transform: rotateY(180deg);
			background-color: lightgrey;
		}
		.back span {
			font-size: 3em;
		}
		@media (min-width: 80em) {
			#backprofilepic {
				height: 8em;
				width: 8em;
			}
			#sidebar {
				position: absolute;
				left: 5em;
				/* distance from left side should = distance from left side of article to the left side of the window divided by two, and then subtract 5em */
				left: calc(calc(calc(50% - 25em) / 2) - 5em);
				top: 5em;
				text-align: center;
				line-height: 0px;
			}
			.flip-container {
				float: none;
				padding: 0px;
			}
			/* flip the pane when hovered */
			.flip-container:hover .flipper, .flip-container.hover .flipper {
				transform: rotateY(180deg);
			}
			.flip-container, .front, .back {
				width: 8em;
				height: 8em;
			}
			.back {
				line-height: 8em;
			}
			.back span {
				font-size: 6em;
			}
		}
		#contentbox {
			width: 100%;
			max-width: 50em;
			min-width: 10%
		}
		article {
			display: inline-block;
			text-align: left;
			/* padding-left: 15vw; */
			/* width: 70vw; */
			width: 100%;
			max-width: 50em;
			min-width: 10%;
			padding-bottom: 5em;
		}
		@media (min-width: 80em) {
			article {
				padding-top: 5em;
			}
		}
		article h1:first-of-type {
			line-height: 0px;
		}
		/* this was originally written for the graphs in the mapping afghanistan post */
		article img {
			width: 100%;
		}
		.centeredtext {
			text-align: center;
		}
		</style>
<script type="application/ld+json">
	{
	"@context": "https://schema.org",
	"@type": "BlogPosting",
	"headline": "üí° Control my Desk Light",
	"author": {
		"@type": "Person",
		"name": "Jacob Hall"
	},
	"dateModified": "2021-03-11T03:00:45"
	}
	</script></head>
<body>
        <div id="sidebar">
                <a class="nostyle p-author h-card" rel="author" href="https://jacobhall.net/">
                <div class="flip-container" ontouchstart="this.classList.toggle('hover');">
                        <div class="flipper">
                                <div class="front">
                                        <img class="profilepic" id="backprofilepic" src="/images/toothbrush_profile_small.jpg" alt="sexy mirror selfie"/>
                                </div>
                                <div class="back">
                                        <span>üè†</span>
                                </div>
                        </div>
                </div>
                        <h5>‚¨ÖÔ∏è Jacob Hall's weblog</h5>
                </a>
        </div>

<article class="h-entry">
<h2 class="p-name">üí° Control my Desk Light</h2>
<span class="date">Last updated on March 11, 2021</span>
<div>
	<input id="colorPicker" type="color" value="#ff0000">
	<button id="sendcolor">Send Color</button>
</div>
<script>
	var color = document.getElementById('colorPicker');
	sendbutton = document.getElementById('sendcolor');
	ws = new WebSocket("wss://ws.jacobhall.net:8080/");
	var message;
	ws.onmessage = function (event) {
		recvColor = event.data;
		console.log("Current color is ".concat(recvColor));
		colorUpdate = recvColor.split(",");
		hexUpdate = convertMessage(colorUpdate[0], colorUpdate[1], colorUpdate[2]);
		console.log("Updated hex:".concat(hexUpdate));
		color.value = hexUpdate;
	};
	function convertHex(hex) {
		var bigint = parseInt(hex, 16);
		var r = (bigint >> 16) & 255;	// RGB value for R
		var g = (bigint >> 8) & 255;	// RGB value for G
		var b = bigint & 255;		// RGB value for B
		// At this point r, g, b are the actual RGB values.
		// Now converting to HSL
		r /= 255;
		g /= 255;
		b /= 255;
		let cmin = Math.min(r,g,b),
			cmax = Math.max(r,g,b),
			delta = cmax - cmin,
			h = 0,
			s = 0,
			l = 0;

		if (delta == 0) h = 0;
		else if (cmax == r)
			h = ((g - b) / delta) % 6;
		else if (cmax == g)
			h = (b - r) / delta + 2;
		else
			h = (r - g) / delta + 4;

		h = Math.round(h * 60);

		if (h < 0) h += 360;

		l = (cmax + cmin) / 2;
		s = delta == 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));
		s = +(s * 65535).toFixed(0);

		// now converting hue to LIFX range
		h = ((h * 65535) / 360).toFixed(0);
		l = +(l * 65535).toFixed(0);

		return h + "," + s + "," + l;
	}

	function convertMessage(h,s,l) {

		// Must be fractions of 1
		h *= 0.005493248;
		s /= 65535;
		l /= 65535;

  let c = (1 - Math.abs(2 * l - 1)) * s,
      x = c * (1 - Math.abs((h / 60) % 2 - 1)),
      m = l - c/2,
      r = 0,
      g = 0,
      b = 0;
if (0 <= h && h < 60) {
    r = c; g = x; b = 0;  
  } else if (60 <= h && h < 120) {
    r = x; g = c; b = 0;
  } else if (120 <= h && h < 180) {
    r = 0; g = c; b = x;
  } else if (180 <= h && h < 240) {
    r = 0; g = x; b = c;
  } else if (240 <= h && h < 300) {
    r = x; g = 0; b = c;
  } else if (300 <= h && h < 360) {
    r = c; g = 0; b = x;
  }
  r = Math.round((r + m) * 255);
  g = Math.round((g + m) * 255);
  b = Math.round((b + m) * 255);

 r = r.toString(16);
  g = g.toString(16);
  b = b.toString(16);

  if (r.length == 1)
    r = "0" + r;
  if (g.length == 1)
    g = "0" + g;
  if (b.length == 1)
    b = "0" + b;

  return "#" + r + g + b;
}
	sendbutton.onclick = function (event) {
		console.log("send button was clicked. value of color picker:")
		var hexcode = color.value;
		while(hexcode.charAt(0)=="#") {
			hexcode = hexcode.substring(1);
		}
		console.log("input hex code:")
		console.log(hexcode);
		var colorToSend = convertHex(hexcode);
		console.log("converted to LIFX hue/sat:");
		console.log(colorToSend);
		ws.send(colorToSend);
  }
</script>
</article>
</body>
</html>